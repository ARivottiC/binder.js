;(function(j){"use strict";var k=Array.prototype,each=k.forEach,filter=k.filter,indexOf=k.indexOf,map=k.map,pop=k.pop,push=k.push,shift=k.shift,slice=k.slice,splice=k.splice,oGroup={},oTemplate={},oListener={},guid=1,rComa=/\s*,\s*/,rDColumn=/\s*:\s*/,rSpaces=/\s+/,rSelected=/(?:^|\s+)selected(?!\S)/,rHidden=/(?:^|\s+)hidden(?!\S)/;function Dummy(){}function define(a,b){var c=slice.call(arguments,2),length=c.length,override=(c.pop()||{});var d=(new Function("c",'return function '+a+'(e,p,a) { c.call(this,e,p,a) }'))(override.constructor===Object?b:override.constructor);Dummy.prototype=b.prototype;d.prototype=new Dummy();for(var i=0;i<length-1;i++){var e=c[i];merge(d.prototype,e.prototype)}merge(d.prototype,override);d.prototype.constructor=d;return(Binder[a]=d)}function getIdOrName(a){return a.getAttribute('id')||a.getAttribute('name')}function has(a,b){return hasOwnProperty.call(a,b)}function inflateVal(a){var b={};if(a.match(rDColumn)){var c=a.split(rComa);for(var d in c){var e=c[d].split(rDColumn);b[e.shift()]=e.shift()}}else if(Binder[a])b.class=a;else b.name=a;return b}function isA(a,b){return a instanceof b}function isFn(a){return typeof a==='function'}function isNull(a){return a===null}function isObj(a){return a===Object(a)}function isUndef(a){return a===void 0}function merge(){var c=shift.call(arguments)||{};each.call(arguments,function(a){if(a)for(var b in a)c[b]=a[b]});return c}function addClass(a,b,c){var d=a.elem;if(!hasClass(a,b))d.className=d.className.concat(' ',c).trim();return a}function attach(a,b,c){if(isUndef(c))return push.call(a,b);splice.call(a,c,0,b);return b}function attachChild(a,b,c){var d=!a.length||isUndef(c)||!a[c]||c!==0,childElem=b.elem,parentElem=a.elem;if(!childElem.parentNode)if(d)parentElem.appendChild(childElem);else parentElem.insertBefore(childElem,a[c].elem);attach(a,b,c)}function attachChildren(a,b){var c=slice.call(b.children);while(c.length){var d=c.shift();if(!isNull(d.getAttribute(Binder.defaultAttr)))a.attach(d);else attachChildren(a,d)}}function attachTemplate(a,b,c){var d=a.guid,tmplAttr=Binder.defaultAttr+'-tmpl',tmplName=b.getAttribute(tmplAttr);if(isNull(tmplName))return;var e=oTemplate[d]||(oTemplate[d]=[]);if(tmplName)e[tmplName]=b;e.push(b);b.removeAttribute(tmplAttr);b.parentNode.removeChild(b);return b}function dettach(a,b){if(isUndef(b))return pop.call(a);var c=indexOf.call(a,b);if(!isUndef(c))return splice.call(a,c,1).pop()}function hasClass(a,b){return b.test(a.elem.className)}function isHidden(a){return a.isHidden()}function isSelected(a){return a.isSelected()}function no(a,b,c){var d=a.elem;return d.removeEventListener.apply(d,arguments)}function on(c,d,e,f){e=e||c[d];e.guid=e.guid||guid++;var g=oListener[c.guid]||(oListener[c.guid]={});var h=g[d]||(g[d]={});var i=h[e.guid]||(h[e.guid]=function(a){var b=e.call(c,a);if(b===false){a.preventDefault();a.stopPropagation()}return b});return c.elem.addEventListener(d,i,f)}function remClass(a,b){var c=a.elem;c.className=c.className.replace(b,'').trim();return a}function setIsProp(a,b){if(isUndef(b))return false;var c=b.split(rSpaces);while(c.length)a['is'+ucFirst(c.shift())]=true;return true}function ucFirst(b){return b.replace(/^[a-z]/,function(a){return a.toUpperCase()})}function BinderCollection(){push.apply(this,arguments)}Dummy.prototype=Array.prototype;var l=BinderCollection.prototype=new Dummy(),binderColSlice=l.slice;merge(l,{exec:function(b){var c=splice.call(arguments,1);this.forEach(function(a){a[b].apply(a,c)});return this},filter:function(){return this.slice.apply(filter.apply(this,arguments))},isHidden:function(){return this.filter(isHidden)},isSelected:function(){return this.filter(isSelected)},map:function(){return this.slice.apply(map.apply(this,arguments))},slice:function(){var a=new BinderCollection();a.push.apply(a,slice.apply(this,arguments));return a},splice:function(){return this.slice.apply(splice.apply(this,arguments))}});l.constructor=BinderCollection;function Binder(a,b,d){d=d||{};var e=this;e.elem=a;e.guid=guid++;var c=d.group||e.group;if(c){e.group=(oGroup[c]||(oGroup[c]=new BinderCollection()));e.group.push(e)}var f=d.name||getIdOrName(a);if(f)e.name=f;setIsProp(e,d.type);if(isObj(b)){e.root=b.root||b;e.context=b.isContext?b:b.context;e.parent=b}else e.root=e.context=e;attachChildren(e,a);return e}Binder.prototype={attach:function(a,b){var c=this;if(!a.nodeType){a=oTemplate[c.guid][a].cloneNode(true)}b=merge({class:Binder.defaultClass},inflateVal(a.getAttribute(Binder.defaultAttr)),b);if(attachTemplate(c,a,b))return;var d=Binder[b.class];if(isUndef(d))throw"can't use "+b.class+", maybe you forgot to set it?";var e=new d(a,c,b),name=e.name;if(!isA(e,Binder))throw"not a Binder Object!";if(!isUndef(name))e.context[name]=e;attachChild(c,e,b.index);return e},children:function(a){var b=this;switch(typeof a){case"object":if(indexOf.call(b,a)>=0)return new BinderCollection(a);break;case"string":case"number":if(has(b,a))return new BinderCollection(b[a]);break;default:var c=l.slice.call(b);if(isFn(a))return c.filter(a);return c}},destructor:function(){var a=this;a.value(null);var b=a.group;if(b){var c=indexOf.call(b,a);if(c>=0){b[c]=null;b.splice(c,1)}a.group=null}oTemplate[a.guid]=null;a.elem.parentNode.removeChild(a.elem);a.elem=null;a.context=null;a.parent=null;a.root=null},dettach:function(a){var b=dettach(this,a);if(isUndef(b))return;if(!isUndef(b.name))delete b.context[b.name];b.destructor();b=null},deselect:function(){return remClass(this,rSelected)},isHidden:function(){return hasClass(this,rHidden)},isSelected:function(){return hasClass(this,rSelected)},hide:function(){return addClass(this,rHidden,'hidden')},length:0,next:function(){var a=this.parent;if(a){var b=indexOf.call(a,this);if(b<a.length-1)return a[b+1]}return false},prev:function(){var a=this.parent;if(a){var b=indexOf.call(a,this);if(b>0)return a[b-1]}return false},select:function(){return addClass(this,rSelected,'selected')},show:function(){return remClass(this,rHidden)},swap:function(c){var d=this.parent;var e=indexOf.call(d,this),index2=indexOf.call(d,c);if(index2<0)return false;d[e]=splice.call(d,index2,1,d[e]).pop();var a=this.elem;var b=c.elem;var t=a.parentNode.insertBefore(document.createTextNode(''),a);b.parentNode.insertBefore(a,b);t.parentNode.insertBefore(b,t);t.parentNode.removeChild(t);return[e,index2]},toString:function(){return'[object Binder]'},update:function(a){var b=this;if(isObj(a)){for(var c in a){var d=a[c];var e=b[c];if(isFn(e))e.call(b,d);else if(has(b,c))if(isA(e,Binder))e.update(d);else b[c]=d}return b}else return b.value(a)},value:function(a){var b=this,elem=b.elem;if(isUndef(a))return elem.innerHTML;while(b.length)b.dettach();return(elem.innerHTML=a)}},Binder.prototype.constructor=Binder,Binder.VERSION='3.0.4',Binder.define=define,Binder.no=no,Binder.on=on,Binder.defaultAttr='data-binder',Binder.defaultClass='Binder',Binder.Binder=Binder;j.Binder=Binder})(window);
