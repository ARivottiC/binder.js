;(function(g){"use strict";var h=Array.prototype,each=h.forEach,filter=h.filter,indexOf=h.indexOf,map=h.map,pop=h.pop,push=h.push,reduce=h.reduce,shift=h.shift,slice=h.slice,splice=h.splice,oGroup={},oTemplate={},oListener={},guid=1,rComa=/\s*,\s*/,rDColumn=/\s*:\s*/,rSpaces=/\s+/,rBinder=/^\s*binder\s*:\s*/;function Dummy(){}function define(a,b){var c=slice.call(arguments,2),length=c.length,override=(c.pop()||{});var d=(new Function("c",'return function '+a+'(e,p,a) { c.call(this,e,p,a) }'))(override.constructor===Object?b:override.constructor);Dummy.prototype=b.prototype;d.prototype=new Dummy();for(var i=0;i<length-1;i++){var e=c[i];merge(d.prototype,e.prototype)}merge(d.prototype,override);d.prototype.constructor=d;return(Binder[a]=d)}function filterComments(a){return isComment(a)&&a.nodeValue.match(rBinder)}function parseComments(a){var b={},comments=filter.call(a.childNodes,filterComments);if(comments.length>0){var c=comments.shift();try{b=JSON.parse(c.nodeValue.replace(rBinder,''));a.removeChild(c)}catch(e){throw e;}}return b}function getIdOrName(a){return a.getAttribute('id')||a.getAttribute('name')}function has(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function inflateVal(c){var d={};if(c.match(rDColumn)){c.split(rComa).forEach(function(a){var b=a.split(rDColumn);d[b.shift()]=b.shift()})}else if(Binder[c])d['class']=c;else d.name=c;return d}function isA(a,b){return a instanceof b}function isComment(a){return a.nodeType===8}function isFn(a){return typeof a==='function'}function isNull(a){return a===null}function isObj(a){return a===Object(a)}function isUndef(a){return a===void 0}function merge(){var c=shift.call(arguments)||{};each.call(arguments,function(a){if(a)for(var b in a)c[b]=a[b]});return c}function pathToObj(){return reduce.call(arguments,function(a,b,i,c){var d=i+1;if(isObj(b)){splice.call(c,d);return a}if(isUndef(a[b]))a[b]=isObj(c[d])?c[d]:{};return a[b]},shift.call(arguments))}function addClass(a,b){a.elem.classList.add(b);return a}function attach(a,b,c){if(isUndef(c))return push.call(a,b);splice.call(a,c,0,b);return b}function attachChild(a,b,c){var d=!a.length||isUndef(c)||!a[c]||c!==0,childElem=b.elem,parentElem=a.elem;if(!(childElem.parentNode&&childElem.parentElement))if(d)parentElem.appendChild(childElem);else parentElem.insertBefore(childElem,a[c].elem);attach(a,b,c)}function attachChildren(b,c){each.call(c.children,function(a){if(isComment(a))return;if(!isNull(a.getAttribute(Binder.defaultAttr)))b.attach(a);else attachChildren(b,a)})}function attachTemplate(a,b,c){var d=a.guid,tmplAttr=Binder.defaultAttr+'-tmpl',tmplName=b.getAttribute(tmplAttr);if(isNull(tmplName))return;var e=pathToObj(oTemplate,d,[]);if(tmplName)e[tmplName]=b;e.push(b);b.removeAttribute(tmplAttr);b.parentNode.removeChild(b);return b}function dettach(a,b){if(isUndef(b))return pop.call(a);var c=indexOf.call(a,b);if(!isUndef(c))return splice.call(a,c,1).pop()}function hasClass(a,b){return a.elem.classList.contains(b)}function isHidden(a){return a.isHidden()}function isSelected(a){return a.isSelected()}function no(a,b,c){var d=a.elem;return d.removeEventListener.apply(d,arguments)}function on(a,b,c,d){c=c||a[b];c.guid=c.guid||guid++;var f=pathToObj(oListener,a.guid,b,c.guid,function(e){var r=c.call(a,e);if(r===false){e.preventDefault();e.stopPropagation()}return r});return a.elem.addEventListener(b,f,d)}function remClass(a,b){a.elem.classList.remove(b);return a}function setIsProp(a,b){if(isUndef(b))return false;var c=b.split(rSpaces);while(c.length)a['is'+ucFirst(c.shift())]=true;return true}function ucFirst(b){return b.replace(/^[a-z]/,function(a){return a.toUpperCase()})}function BinderCollection(){push.apply(this,arguments)}Dummy.prototype=Array.prototype;var j=BinderCollection.prototype=new Dummy(),binderColSlice=j.slice;merge(j,{exec:function(b){var c=splice.call(arguments,1);this.forEach(function(a){a[b].apply(a,c)});return this},filter:function(){return this.slice.apply(filter.apply(this,arguments))},isHidden:function(){return this.filter(isHidden)},isSelected:function(){return this.filter(isSelected)},map:function(){return this.slice.apply(map.apply(this,arguments))},slice:function(){var a=new BinderCollection();a.push.apply(a,slice.apply(this,arguments));return a},splice:function(){return this.slice.apply(splice.apply(this,arguments))}});j.constructor=BinderCollection;function Binder(a,b,d){d=d||{};var e=this;e.elem=a;e.guid=guid++;var c=d.group||e.group;if(c){e.group=pathToObj(oGroup,c,new BinderCollection())e.group.push(e)}var f=d.name||getIdOrName(a);if(f)e.name=f;setIsProp(e,d.type);if(isObj(b)){e.root=b.root||b;e.context=b.isContext?b:b.context;e.parent=b}else e.root=e.context=e;attachChildren(e,a);return e}Binder.prototype={attach:function(a,b){var c=this;if(!a.nodeType)a=this.template(a);b=merge({'class':Binder.defaultClass},inflateVal(a.getAttribute(Binder.defaultAttr)),parseComments(a),b);if(attachTemplate(c,a,b))return;var d=Binder[b['class']];if(isUndef(d))throw"can't use "+b['class']+", maybe you forgot to set it?";var e=new d(a,c,b),name=e.name;if(!isA(e,Binder))throw"not a Binder Object!";if(!isUndef(name))e.context[name]=e;attachChild(c,e,b.index);return e},children:function(a){var b=this;switch(typeof a){case"object":if(indexOf.call(b,a)>=0)return new BinderCollection(a);break;case"string":case"number":if(has(b,a))return new BinderCollection(b[a]);break;default:var c=j.slice.call(b);if(isFn(a))return c.filter(a);return c}},destructor:function(){var a=this;a.value(null);var b=a.group;if(b){var c=indexOf.call(b,a);if(c>=0){b[c]=null;b.splice(c,1)}a.group=null}oTemplate[a.guid]=null;a.elem.parentNode.removeChild(a.elem);a.elem=null;a.context=null;a.parent=null;a.root=null},dettach:function(a){var b=dettach(this,a);if(isUndef(b))return;if(!isUndef(b.name))delete b.context[b.name];b.destructor();b=null},deselect:function(){return remClass(this,'selected')},isHidden:function(){return hasClass(this,'hidden')},isSelected:function(){return hasClass(this,'selected')},hide:function(){return addClass(this,'hidden')},length:0,next:function(){var a=this.parent;if(a){var b=indexOf.call(a,this);if(b<a.length-1)return a[b+1]}return false},prev:function(){var a=this.parent;if(a){var b=indexOf.call(a,this);if(b>0)return a[b-1]}return false},select:function(){return addClass(this,'selected')},show:function(){return remClass(this,'hidden')},swap:function(c){var d=this.parent;if(!d)return;var e=indexOf.call(d,this),index2=indexOf.call(d,c);if(index2<0)return false;d[e]=splice.call(d,index2,1,d[e]).pop();var a=this.elem;var b=c.elem;var t=a.parentNode.insertBefore(document.createTextNode(''),a);b.parentNode.insertBefore(a,b);t.parentNode.insertBefore(b,t);t.parentNode.removeChild(t);return[e,index2]},template:function(a){return pathToObj(oTemplate,this.guid,a).cloneNode(true)},toString:function(){return'[object Binder]'},update:function(a){var b=this;if(isObj(a)){for(var c in a){var d=a[c];var e=b[c];if(isFn(e))e.call(b,d);else if(has(b,c))if(isA(e,Binder))e.update(d);else b[c]=d}return b}else return b.value(a)},value:function(a){var b=this,elem=b.elem;if(isUndef(a))return elem.innerHTML;while(b.length)b.dettach();return(elem.innerHTML=a)}},Binder.prototype.constructor=Binder,Binder.VERSION='3.1.6',Binder.define=define,Binder.no=no,Binder.on=on,Binder.defaultAttr='data-binder',Binder.defaultClass='Binder',Binder.Binder=Binder;g.Binder=Binder})(window);
